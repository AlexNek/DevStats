<Window x:Class="DevStats.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DevStats"
        xmlns:viewModels="clr-namespace:DevStats.ViewModels"
        xmlns:converters="clr-namespace:DevStats.Converters"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="450" Width="800">
  <Window.Resources>
    <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
  </Window.Resources>
  <DockPanel>
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem Header="New" />
        <MenuItem Header="Open Folder..." Command="{Binding CommandOpenFolder}" />
        <Separator />
        <MenuItem Header="Exit" Command="{Binding CommandExit}" />
      </MenuItem>
      <MenuItem Header="_Scan">
        <MenuItem Header="Start Scan"
                  Command="{Binding CommandStartScan}"
                  IsEnabled="{Binding IsScanRunning, Converter={StaticResource InverseBooleanConverter}}" />
        <MenuItem Header="Cancel Scan"
                  Command="{Binding CommandCancelScan}"
                  IsEnabled="{Binding IsScanRunning}" />
      </MenuItem>
      <MenuItem Header="_Options">
        <MenuItem Header="Settings..." Command="{Binding CommandSettings}" />
      </MenuItem>
      <MenuItem Header="_Help">
        <MenuItem Header="About" Command="{Binding CommandShowAbout}" />
      </MenuItem>
    </Menu>
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <!-- Modal overlay for scan progress -->
      <Border
        Background="#80000000" 
        Visibility="{Binding IsScanFlyoutOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
        HorizontalAlignment="Stretch"
        VerticalAlignment="Stretch"
        Panel.ZIndex="100">
        <Border
          Background="White"
          CornerRadius="12"
          Padding="32"
          BorderBrush="#FFCCCCCC"
          BorderThickness="2"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext}">
          <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="2"/>
          </Border.Effect>
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
            <TextBlock Text="Scan in progress" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
            <TextBlock Text="{Binding ScanStatus}" FontSize="14" Margin="0,0,0,10"/>
            <Button Content="Cancel Scan"
                    Command="{Binding CommandCancelScan}"
                    IsEnabled="{Binding IsScanRunning}"
                    HorizontalAlignment="Right"
                    Padding="10,4"/>
          </StackPanel>
        </Border>
      </Border>
      <!-- Folder title -->
      <StackPanel Grid.Row="0"
                  Orientation="Horizontal"
                  VerticalAlignment="Center"
                  Margin="10,0,0,0"
                  Visibility="{Binding OpenedFolderPath, Converter={StaticResource StringToVisibilityConverter}}">
        <Button Command="{Binding CommandStartScan}"
                IsEnabled="{Binding IsScanRunning, Converter={StaticResource InverseBooleanConverter}}"
                ToolTip="Start Scan"
                Width="32" Height="32" Margin="0,0,8,0"
                VerticalAlignment="Center"
                Padding="0">
          <TextBlock Text="▶"
                     Foreground="Green"
                     FontSize="20"
                     VerticalAlignment="Center"
                     HorizontalAlignment="Center"/>
        </Button>
        <TextBlock Text="{Binding OpenedFolderPath}"
                   FontSize="18"
                   FontWeight="Bold"
                   VerticalAlignment="Center"/>
      </StackPanel>
      <!-- Cards list -->
      <ScrollViewer Grid.Row="1"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
        <ItemsControl ItemsSource="{Binding Cards}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel IsItemsHost="True"
                         Orientation="Horizontal"
                         Margin="10"
                         ItemWidth="400"
                         MinWidth="400"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border BorderBrush="Gray"
                      BorderThickness="1"
                      CornerRadius="8"
                      Margin="5"
                      Padding="10"
                      Background="White"
                      SnapsToDevicePixels="True"
                      UseLayoutRounding="True"
                      HorizontalAlignment="Left"
                      MinWidth="200"
                      MaxWidth="450">
                <DockPanel>
                <!--  copy button -->
                <Button DockPanel.Dock="Right"
                        Command="{Binding DataContext.CommandCopyCard, RelativeSource={RelativeSource AncestorType=Window}}"
                        CommandParameter="{Binding}"
                        ToolTip="Copy to Clipboard"
                        Width="24"
                        Height="24"
                        Padding="0"
                        Margin="0,0,0,5"
                        VerticalAlignment="Top"
                        Background="Transparent"
                        BorderThickness="0">
                  <ui:SymbolIcon Symbol="Copy20" Width="20" Height="20" />
                </Button>

                <!-- Card content -->
                <StackPanel>
                  <TextBlock Text="{Binding Title}"
                             FontSize="16"
                             FontWeight="Bold"
                             Margin="0,0,0,5"/>
                  <ContentPresenter Content="{Binding View}" />
                </StackPanel>
                </DockPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </DockPanel>
</Window>